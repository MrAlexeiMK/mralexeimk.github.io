<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MrAlexeiMK</title>
    <link rel="shortcut icon" type="image/x-icon" href="icons/title.ico" />
    <link rel="stylesheet" href="css/material-kit.css">
    <link rel="stylesheet" href="css/myown.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="js/jquery.js" rel="stylesheet"></script>
    <script src="js/conva.js" rel="stylesheet"></script>
    <script src="js/gifler.js" rel="stylesheet"></script>
</head>
<body oncontextmenu="return false">

<div id="container"></div>

<script src="js/popper.js" rel="stylesheet"></script>
<script src="js/material-design.js" rel="stylesheet"></script>
<script src="js/material-kit.js" rel="stylesheet"></script>
<script src="js/particles.js"></script>

<script>
    particlesJS.load('konvajs-content', 'assets/particles.json', function() {
        console.log('callback - particles.js config loaded');
    });
    class Params {
        constructor(src, link, lore, radius, shiftX, shiftY, p1, p2, p3, angle) {
            this.src = src;
            this.link = link;
            this.lore = lore;
            this.radius = radius;
            this.shiftX = shiftX;
            this.shiftY = shiftY;
            this.p1 = p1;
            this.p2 = p2;
            this.p3 = p3;
            this.angle = angle;
        }
    }
    let random = function (min, max) {
        return Math.floor(Math.random() * (max - min + 1) + min);
    };
    let canvas, about, rect;
    let width = window.innerWidth;
    let height = window.innerHeight;
    let sunWidth = 150;
    let sunHeight = 150;

    let sunX = random(width/2-200, width/2-50), sunY = random(height/2-150, height/2-20);

    sunX += sunWidth/2;
    sunY += sunHeight/2;

    let stage = new Konva.Stage({
        container: 'container',
        width: width-10,
        height: height-10,
    });

    let layer = new Konva.Layer();
    stage.add(layer);

    init();
    let container = document.getElementsByClassName('konvajs-content');
    container[0].id = "konvajs-content";

    let chess = new Params("images/chess.png", "https://github.com/MrAlexeiMK/Chess/raw/main/%D0%A8%D0%B0%D1%85%D0%BC%D0%B0%D1%82%D1%8B%20(%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D1%89%D0%B8%D0%BA).msi",
    "CHESS\n\nChess with Artificial Intelligence",
        40, -150, -120, 1.5, 1, 3, 0.0015);
    let objector = new Params("images/objector.png", "https://github.com/MrAlexeiMK/Objector/raw/main/Objector.jar",
    "Objector\n\nInterface for constructing and training convolutional neural networks",
        30, 200, 100, 1, 1, -2.5, 0.001);
    let graphGenerator = new Params("images/graphGenerator.png", "https://github.com/MrAlexeiMK/GraphGenerator/raw/main/GraphGenerator.jar",
    "GraphGenerator\n\nInterface for generating graph by Stephen Wolfram article",
    25, 200, 100, 1, 1, 4, -0.0005);

    addPlanets([objector, chess, graphGenerator]);
    addSun();

    function showText(lore) {
        about.text(lore);
        about.visible(true);
        rect.visible(true);
    }

    function addPlanets(list) {
        for(let i = 0; i < list.length; ++i) {
            let params = list[i];
            let planet = new Image();
            let orbitRadius = Math.sqrt(
                Math.pow(Math.abs(params.shiftX)-params.radius/2,2)+Math.pow(Math.abs(params.shiftY)-params.radius/2,2)
            );
            planet.onload = function () {
                let pl = new Konva.Image({
                    x: sunX+params.shiftX,
                    y: sunY+params.shiftY,
                    image: planet,
                    width: params.radius,
                    height: params.radius,
                    visible: false,
                });

                pl.on('mouseenter', function () {
                    stage.container().style.cursor = 'pointer';
                    showText(params.lore);
                    anim.stop();
                });
                pl.on('mouseleave', function () {
                    stage.container().style.cursor = 'default';
                    pl.fill("transparent");
                    about.visible(false);
                    rect.visible(false);
                    anim.start();
                });
                pl.on('click', function () {
                    about.visible(false);
                    window.open(params.link);
                });
                layer.add(pl);
                layer.add(rect);
                layer.add(about);

                let anim = new Konva.Animation(function (frame) {
                    pl.x(
                        params.p1*orbitRadius*Math.cos(params.angle*frame.time) + sunX
                    );
                    pl.y(
                        params.p2*orbitRadius*Math.sin(params.angle*frame.time) + sunY
                    );
                    if(!pl.isVisible()) pl.visible(true);
                    let scale = Math.cos(params.angle*frame.time)+params.p3;
                    pl.scale({
                        x: scale,
                        y: scale,
                    });
                }, layer);
                anim.start();
            };
            planet.src = params.src;
        }
    }

    function addSun() {
        let sunObj = new Image();
        let githubObj = new Image();
        sunObj.onload = function () {
            let sun = new Konva.Image({
                x: sunX-sunWidth/2,
                y: sunY-sunHeight/2,
                image: canvas,
                width: sunWidth,
                height: sunHeight,
            });

            let link = new Konva.Image({
                x: sunX-60,
                y: sunY-70,
                image: githubObj,
                width: 120,
                height: 120,
            });

            sun.on('mouseenter', function () {
                stage.container().style.cursor = 'pointer';
            });
            link.on('mouseenter', function () {
                stage.container().style.cursor = 'pointer';
            });

            sun.on('mouseleave', function () {
                stage.container().style.cursor = 'default';
            });
            link.on('mouseleave', function () {
                stage.container().style.cursor = 'default';
            });

            sun.on('click', function () {
                window.open('https://github.com/MrAlexeiMK');
                stage.container().style.cursor = 'default';
            });
            link.on('click', function () {
                window.open('https://github.com/MrAlexeiMK');
                stage.container().style.cursor = 'default';
            });

            layer.add(sun);
            layer.add(link);

            let angle = 0.01;
            let anim = new Konva.Animation(function (frame) {
                sun.x(
                    Math.cos(angle*frame.time)/10 + sun.getPosition().x
                );
                sun.y(
                    Math.sin(angle*frame.time)/5 + sun.getPosition().y
                );
                link.x(
                    Math.cos(angle*frame.time)/10 + link.getPosition().x
                );
                link.y(
                    Math.sin(angle*frame.time)/5 + link.getPosition().y
                );
            }, layer);
            anim.start();
        };
        sunObj.src = 'images/sun.gif';
        githubObj.src = 'images/github.png';
    }

    function init() {
        canvas = document.createElement('canvas');
        function onDrawFrame(ctx, frame) {
            canvas.width = frame.width;
            canvas.height = frame.height;
            ctx.drawImage(frame.buffer, 0, 0);
            layer.draw();
        }
        gifler('images/sun.gif').frames(canvas, onDrawFrame);
        about = new Konva.Text({
            x: width/2-150,
            y: 0,
            text:
                "\n\n\n",
            fontSize: 18,
            fontFamily: 'Calibri',
            fill: '#555',
            width: 300,
            padding: 20,
            align: 'center',
            visible: false,
        });
        rect = new Konva.Rect({
            x: width/2-150,
            y: 0,
            stroke: '#555',
            strokeWidth: 5,
            fill: '#ddd',
            width: 300,
            height: about.height(),
            shadowColor: 'black',
            shadowBlur: 10,
            shadowOffsetX: 10,
            shadowOffsetY: 10,
            shadowOpacity: 0.2,
            cornerRadius: 10,
            visible: false,
        });
    }
</script>
</body>
</html>